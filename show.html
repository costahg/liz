<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Comparativo de Proposta – Visual HTML</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
<style>
  :root {
    --bg: #0b0c10;
    --card: #111216;
    --card-2: #0f1115;
    --text: #e7e9ee;
    --muted: #9aa3b2;
    --border: #1f2330;
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
    --radius: 16px;
    --purple: #4f46e5;
    --cyan: #06b6d4;
    --green: #16a34a;
    --amber: #f59e0b;
    --red: #ef4444;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0; padding: 24px; background: var(--bg); color: var(--text);
    font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
  }
  .container { max-width: 1120px; margin: 0 auto; }
  .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .title { font-size: 22px; font-weight: 800; letter-spacing: .2px; }
  .subtitle { color: var(--muted); font-size: 12px; }
  .btn { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 8px 12px; border-radius: 10px; cursor: pointer; }
  .btn:hover { border-color: #2b3040; }

  .grid { display: grid; gap: 16px; }
  .grid-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  @media (max-width: 900px) { .grid-3 { grid-template-columns: 1fr; } .grid-2 { grid-template-columns: 1fr; } }

  .card { background: linear-gradient(180deg, var(--card), var(--card-2)); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); }
  .card-header { padding: 14px 16px 0 16px; }
  .card-title { font-weight: 700; font-size: 14px; }
  .card-desc { color: var(--muted); font-size: 12px; margin-top: 2px; }
  .card-content { padding: 8px 16px 16px 16px; }
  .number-xl { font-size: 34px; font-weight: 800; letter-spacing: .2px; }
  .muted { color: var(--muted); }
  .sep { height: 1px; width: 100%; background: var(--border); margin: 12px 0; }

  .tabs { margin: 8px 0 16px 0; }
  .tabs .tab-buttons { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 8px; }
  .tabs .tab-buttons button { padding: 8px 10px; border-radius: 10px; border: 1px solid var(--border); background: #0d1016; color: var(--text); cursor: pointer; }
  .tabs .tab-buttons button.active { outline: 2px solid #2b3040; }
  .tab-content { margin-top: 12px; }

  canvas { width: 100% !important; height: 100% !important; }
  .h-180 { height: 180px; }
  .h-220 { height: 220px; }
  .h-260 { height: 260px; }
  .h-300 { height: 300px; }

  /* Rodapé cálculos */
  .footer { margin-top: 18px; padding: 14px; border: 1px solid var(--border); border-radius: var(--radius); background: #0f1117; }
  .footer h3 { margin: 4px 0 10px 0; font-size: 13px; }
  .footer .cols { display: grid; gap: 12px; grid-template-columns: repeat(3, minmax(0, 1fr)); }
  .footer .cols .card { box-shadow: none; }
  .footer ul { margin: 4px 0; padding-left: 16px; }
  .footer li { margin: 2px 0; }
  .footer .grid-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }

  /* Impressão */
  @media print {
    @page { size: A4; margin: 10mm; }
    body { padding: 0; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .btn { display: none; }
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <div class="title">Comparativo visual de proposta</div>
        <div class="subtitle">Valor por hora, dinheiro e tempo, com conferência de cálculos</div>
      </div>
      <button class="btn" onclick="window.print()">Imprimir</button>
    </div>

    <!-- Linha 1: cards principais -->
    <div class="grid grid-3">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Valor por hora efetivo</div>
          <div class="card-desc">Inclui deslocamento</div>
        </div>
        <div class="card-content">
          <div class="h-220"><canvas id="chartHourly"></canvas></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Pagamento mensal</div>
          <div class="card-desc">Atual, oferta pré e pós promo</div>
        </div>
        <div class="card-content">
          <div class="h-220"><canvas id="chartMonthly"></canvas></div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Diferencial mensal</div>
          <div class="card-desc">Atual menos oferta pré-promo</div>
        </div>
        <div class="card-content">
          <div class="number-xl" id="deltaMensal">R$ 0,00</div>
          <div class="muted" style="margin-top:6px">Aporte mensal sugerido no Tesouro</div>
          <div class="sep"></div>
          <div class="muted" style="font-size:12px">Base Selic 15% ao ano e custódia 0,2% ao ano</div>
        </div>
      </div>
    </div>

    <!-- Linha 2: tempo semanal -->
    <div class="grid grid-2" style="margin-top:16px">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Tempo semanal atual</div>
          <div class="card-desc">Trabalho e deslocamento</div>
        </div>
        <div class="card-content">
          <div class="h-260"><canvas id="chartTimeCurrent"></canvas></div>
          <div class="muted" style="font-size:12px;margin-top:6px">Total semanal <span id="totalSemanaAtual"></span> h</div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Tempo semanal oferta</div>
          <div class="card-desc">Trabalho e deslocamento</div>
        </div>
        <div class="card-content">
          <div class="h-260"><canvas id="chartTimeOffer"></canvas></div>
          <div class="muted" style="font-size:12px;margin-top:6px">Total semanal <span id="totalSemanaOferta"></span> h</div>
        </div>
      </div>
    </div>

    <!-- Linha 3: perda e payback -->
    <div class="grid grid-2" style="margin-top:16px">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Perda acumulada pré-promo</div>
        </div>
        <div class="card-content">
          <div class="h-220"><canvas id="chartLoss"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Meses para empatar após a promoção</div>
          <div class="card-desc">Ganho mensal pós-promo <span id="ganhoPosPromo"></span></div>
        </div>
        <div class="card-content">
          <div class="h-220"><canvas id="chartPayback"></canvas></div>
        </div>
      </div>
    </div>

    <!-- Linha 4: investimento ao ficar no atual (abas) -->
    <div class="tabs">
      <div class="tab-buttons">
        <button class="active" id="tab12Btn">Cenário 12 meses</button>
        <button id="tab24Btn">Cenário 24 meses</button>
      </div>
      <div class="tab-content" id="tab12">
        <div class="grid grid-2">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Evolução do saldo investido</div>
              <div class="card-desc">Aportes mensais <span id="aporteMensal12"></span></div>
            </div>
            <div class="card-content">
              <div class="h-300"><canvas id="chartInvest12"></canvas></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">Renda passiva estimada</div>
              <div class="card-desc">Líquida e bruta</div>
            </div>
            <div class="card-content">
              <div class="muted" style="font-size:12px">Saldo líquido base pré IR</div>
              <div class="number-xl" id="saldo12">R$ 0,00</div>
              <div class="sep"></div>
              <div class="grid grid-2">
                <div>
                  <div class="muted" style="font-size:12px">Mensal líquida</div>
                  <div style="font-size:22px;font-weight:700" id="rendaLiq12">R$ 0,00</div>
                </div>
                <div>
                  <div class="muted" style="font-size:12px">Mensal bruta</div>
                  <div style="font-size:22px;font-weight:700" id="rendaBru12">R$ 0,00</div>
                </div>
              </div>
              <div class="sep"></div>
              <div class="muted" style="font-size:12px">Total mensal atual com líquida <span id="totalMensal12"></span></div>
              <div class="muted" style="font-size:12px">Total mensal atual com bruta <span id="totalMensal12Bru"></span></div>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-content" id="tab24" style="display:none">
        <div class="grid grid-2">
          <div class="card">
            <div class="card-header">
              <div class="card-title">Evolução do saldo investido</div>
              <div class="card-desc">Aportes mensais <span id="aporteMensal24"></span></div>
            </div>
            <div class="card-content">
              <div class="h-300"><canvas id="chartInvest24"></canvas></div>
            </div>
          </div>
          <div class="card">
            <div class="card-header">
              <div class="card-title">Renda passiva estimada</div>
              <div class="card-desc">Líquida e bruta</div>
            </div>
            <div class="card-content">
              <div class="muted" style="font-size:12px">Saldo líquido base pré IR</div>
              <div class="number-xl" id="saldo24">R$ 0,00</div>
              <div class="sep"></div>
              <div class="grid grid-2">
                <div>
                  <div class="muted" style="font-size:12px">Mensal líquida</div>
                  <div style="font-size:22px;font-weight:700" id="rendaLiq24">R$ 0,00</div>
                </div>
                <div>
                  <div class="muted" style="font-size:12px">Mensal bruta</div>
                  <div style="font-size:22px;font-weight:700" id="rendaBru24">R$ 0,00</div>
                </div>
              </div>
              <div class="sep"></div>
              <div class="muted" style="font-size:12px">Total mensal atual com líquida <span id="totalMensal24"></span></div>
              <div class="muted" style="font-size:12px">Total mensal atual com bruta <span id="totalMensal24Bru"></span></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Linha 5: quanto faria no atual no tempo de payback -->
    <div class="grid grid-2">
      <div class="card">
        <div class="card-header">
          <div class="card-title">Ficar e investir pelo payback de 12m</div>
          <div class="card-desc">Meses de payback <span id="payback12"></span></div>
        </div>
        <div class="card-content">
          <div class="number-xl" id="fvPayback12">R$ 0,00</div>
          <div class="muted" style="font-size:12px;margin-top:6px">Saldo estimado ao investir a diferença durante o payback</div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div class="card-title">Ficar e investir pelo payback de 24m</div>
          <div class="card-desc">Meses de payback <span id="payback24"></span></div>
        </div>
        <div class="card-content">
          <div class="number-xl" id="fvPayback24">R$ 0,00</div>
          <div class="muted" style="font-size:12px;margin-top:6px">Saldo estimado ao investir a diferença durante o payback</div>
        </div>
      </div>
    </div>

    <!-- Rodapé de verificação -->
    <div class="footer">
      <h3>Fórmulas, dados e conferência, como cada valor foi obtido</h3>
      <div class="grid grid-2" style="gap:16px; grid-template-columns: 2fr 3fr;">
        <div>
          <div class="card">
            <div class="card-header"><div class="card-title">A. Parâmetros</div></div>
            <div class="card-content">
              <ul>
                <li>Semanas por mês: <span id="weeksPerMonth"></span></li>
                <li>Atual: 34h × R$18 e 12h × R$30</li>
                <li>Desloc. atual: 10 min/dia × 5 dias</li>
                <li>Oferta: 35h × R$12</li>
                <li>Desloc. oferta: 3h/dia × 6 dias</li>
                <li>Salário pós promo: R$6.000</li>
                <li>Selic: 15% a.a., custódia: 0,2% a.a.</li>
                <li>IR: 12m 20%, 24m 15% (sobre rendimentos)</li>
              </ul>
            </div>
          </div>
          <div class="card" style="margin-top:12px">
            <div class="card-header"><div class="card-title">B. Fórmulas</div></div>
            <div class="card-content">
              <ul>
                <li>1) Semanal atual = 34×18 + 12×30</li>
                <li>2) Mensal = semanal × semanas/mês</li>
                <li>3) Semanal oferta = 35×12</li>
                <li>4) Δ mensal = mensal atual − mensal oferta</li>
                <li>5) Desloc. semanal (h) = (min/dia ÷ 60) × dias/sem</li>
                <li>6) Valor/h efetivo = pagamento semanal ÷ (horas trabalho + horas desloc.)</li>
                <li>7) rₘ bruta = Selic/12, rₘ líquida pré IR = (Selic − custódia)/12</li>
                <li>8) FV aportes = PMT × [((1+r)ⁿ − 1)/r]</li>
                <li>9) Perda acumulada = Δ × n</li>
                <li>10) Ganho pós promo = 6000 − mensal atual</li>
                <li>11) Payback (meses) = ⌈perda ÷ ganho pós promo⌉</li>
              </ul>
            </div>
          </div>
        </div>
        <div>
          <div class="card">
            <div class="card-header"><div class="card-title">C. Passos numéricos</div></div>
            <div class="card-content">
              <div style="font-weight:700;margin-bottom:6px">D1. Salários e hora efetiva</div>
              <ul>
                <li>1) Semanal atual = 34×18 + 12×30 = <span id="vSemAtual"></span></li>
                <li>2) Mensal atual = <span id="vSemAtual2"></span> × <span id="vSemanas"></span> = <span id="vMenAtual"></span></li>
                <li>3) Semanal oferta = 35×12 = <span id="vSemOferta"></span></li>
                <li>4) Mensal oferta = <span id="vSemOferta2"></span> × <span id="vSemanas2"></span> = <span id="vMenOferta"></span></li>
                <li>5) Δ mensal = <span id="vMenAtual2"></span> − <span id="vMenOferta2"></span> = <span id="vDelta"></span></li>
                <li>6) Desloc. atual = 10/60 × 5 = <span id="vDeslAtual"></span> h/sem</li>
                <li>7) Desloc. oferta = 3 × 6 = <span id="vDeslOferta"></span> h/sem</li>
                <li>8) Valor/h atual = <span id="vSemAtual3"></span> ÷ <span id="vHorasAtuais"></span> = <span id="vHoraAtual"></span>/h</li>
                <li>9) Valor/h oferta = <span id="vSemOferta3"></span> ÷ <span id="vHorasOferta"></span> = <span id="vHoraOferta"></span>/h</li>
              </ul>
              <div class="sep"></div>
              <div style="font-weight:700;margin-bottom:6px">D2. Cenários de 12m e 24m</div>
              <ul>
                <li>rₘ bruta = <span id="vRmBru"></span>, rₘ líquida pré IR = <span id="vRmLiq"></span></li>
              </ul>
              <div style="display:grid;gap:8px;grid-template-columns:1fr 1fr">
                <div>
                  <div style="font-weight:700">12 meses</div>
                  <ul>
                    <li>Perda = <span id="vDelta12"></span> × 12 = <span id="vPerda12"></span></li>
                    <li>Ganho pós promo = 6000 − <span id="vMenAtual3"></span> = <span id="vGanho12"></span></li>
                    <li>Payback = ⌈<span id="vPerda12b"></span> ÷ <span id="vGanho12b"></span>⌉ = <span id="vPay12"></span> meses</li>
                    <li>FV líquido = PMT × ((1+r)^{12} − 1)/r = <span id="vFVLiq12"></span></li>
                    <li>Renda bruta = FV_bruto × rₘ bruta = <span id="vRendaBru12"></span></li>
                    <li>Renda líquida ≈ FV_líquido × rₘ líquida × (1−20%) = <span id="vRendaLiq12"></span></li>
                  </ul>
                </div>
                <div>
                  <div style="font-weight:700">24 meses</div>
                  <ul>
                    <li>Perda = <span id="vDelta24"></span> × 24 = <span id="vPerda24"></span></li>
                    <li>Ganho pós promo = 6000 − <span id="vMenAtual4"></span> = <span id="vGanho24"></span></li>
                    <li>Payback = ⌈<span id="vPerda24b"></span> ÷ <span id="vGanho24b"></span>⌉ = <span id="vPay24"></span> meses</li>
                    <li>FV líquido = PMT × ((1+r)^{24} − 1)/r = <span id="vFVLiq24"></span></li>
                    <li>Renda bruta = FV_bruto × rₘ bruta = <span id="vRendaBru24"></span></li>
                    <li>Renda líquida ≈ FV_líquido × rₘ líquida × (1−15%) = <span id="vRendaLiq24"></span></li>
                  </ul>
                </div>
              </div>
              <div class="muted" style="font-size:12px;margin-top:6px">Payback equivale aos meses necessários para compensar a perda acumulada com o ganho mensal pós promoção.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== Helpers =====
  const brl = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 2 });
  const pct = (n) => (n * 100).toFixed(2) + '%';
  const monthlyRateFromAnnual = (a) => a / 12;
  const fvAnnuity = (pmt, r, n) => r === 0 ? pmt * n : pmt * ((1 + r) ** n - 1) / r;

  const params = {
    current: { h18: 34, r18: 18, h30: 12, r30: 30, commuteMinPerDay: 10, daysPerWeek: 5 },
    offer: { hoursPerWeek: 35, rate: 12, commuteHoursPerDay: 3, daysPerWeek: 6, postPromoSalary: 6000 },
    finance: { annualSelic: 0.15, custody: 0.002 },
    weeksPerMonth: 4.333333333,
  };

  function baseCalc() {
    const { current, offer, finance, weeksPerMonth } = params;
    const weeklyCurrent = current.h18 * current.r18 + current.h30 * current.r30; // 972
    const monthlyCurrent = weeklyCurrent * weeksPerMonth; // ~4212
    const weeklyOffer = offer.hoursPerWeek * offer.rate; // 420
    const monthlyOffer = weeklyOffer * weeksPerMonth; // ~1820
    const weeklyCurrentCommuteHours = (current.commuteMinPerDay / 60) * current.daysPerWeek; // 0,83
    const weeklyOfferCommuteHours = offer.commuteHoursPerDay * offer.daysPerWeek; // 18
    const effectiveHourlyCurrent = weeklyCurrent / (current.h18 + current.h30 + weeklyCurrentCommuteHours);
    const effectiveHourlyOffer = weeklyOffer / (offer.hoursPerWeek + weeklyOfferCommuteHours);
    const monthlyDelta = monthlyCurrent - monthlyOffer;
    const annualNetBeforeIR = finance.annualSelic - finance.custody;
    const rMonthGross = monthlyRateFromAnnual(finance.annualSelic);
    const rMonthNetBeforeIR = monthlyRateFromAnnual(annualNetBeforeIR);
    return { weeklyCurrent, weeklyOffer, monthlyCurrent, monthlyOffer, weeklyCurrentCommuteHours, weeklyOfferCommuteHours, effectiveHourlyCurrent, effectiveHourlyOffer, monthlyDelta, rMonthGross, rMonthNetBeforeIR };
  }

  function investmentSeries(months, r, pmt) {
    const arr = []; let bal = 0;
    for (let m = 1; m <= months; m++) { bal = bal * (1 + r) + pmt; arr.push({ mes: m, saldo: bal }); }
    return arr;
  }

  function computeScenario(monthsPrePromo, irRate) {
    const b = baseCalc();
    const cumulativeLoss = b.monthlyDelta * monthsPrePromo;
    const monthlyGainPostPromo = params.offer.postPromoSalary - b.monthlyCurrent;
    const paybackMonths = Math.ceil(cumulativeLoss / monthlyGainPostPromo);
    const fvGross = fvAnnuity(b.monthlyDelta, b.rMonthGross, monthsPrePromo);
    const fvNetBeforeIR = fvAnnuity(b.monthlyDelta, b.rMonthNetBeforeIR, monthsPrePromo);
    const monthlyPassiveGross = fvGross * b.rMonthGross;
    const monthlyPassiveNet = fvNetBeforeIR * b.rMonthNetBeforeIR * (1 - irRate);
    const series = investmentSeries(monthsPrePromo, b.rMonthNetBeforeIR, b.monthlyDelta);
    const fvPaybackNetBeforeIR = fvAnnuity(b.monthlyDelta, b.rMonthNetBeforeIR, paybackMonths);
    return { monthsPrePromo, irRate, cumulativeLoss, monthlyGainPostPromo, paybackMonths, fvGross, fvNetBeforeIR, monthlyPassiveGross, monthlyPassiveNet, series, fvPaybackNetBeforeIR };
  }

  function setText(id, text) { const el = document.getElementById(id); if (el) el.textContent = text; }

  function init() {
    const b = baseCalc();
    const sc12 = computeScenario(12, 0.20);
    const sc24 = computeScenario(24, 0.15);

    // Números chave
    setText('deltaMensal', brl.format(b.monthlyDelta));
    setText('totalSemanaAtual', (params.current.h18 + params.current.h30 + b.weeklyCurrentCommuteHours).toFixed(2));
    setText('totalSemanaOferta', (params.offer.hoursPerWeek + b.weeklyOfferCommuteHours).toFixed(2));
    setText('ganhoPosPromo', brl.format(sc12.monthlyGainPostPromo));
    setText('aporteMensal12', brl.format(b.monthlyDelta));
    setText('aporteMensal24', brl.format(b.monthlyDelta));

    // Cards de renda passiva e totais
    setText('saldo12', brl.format(sc12.fvNetBeforeIR));
    setText('rendaLiq12', brl.format(sc12.monthlyPassiveNet));
    setText('rendaBru12', brl.format(sc12.monthlyPassiveGross));
    setText('totalMensal12', brl.format(b.monthlyCurrent + sc12.monthlyPassiveNet));
    setText('totalMensal12Bru', brl.format(b.monthlyCurrent + sc12.monthlyPassiveGross));

    setText('saldo24', brl.format(sc24.fvNetBeforeIR));
    setText('rendaLiq24', brl.format(sc24.monthlyPassiveNet));
    setText('rendaBru24', brl.format(sc24.monthlyPassiveGross));
    setText('totalMensal24', brl.format(b.monthlyCurrent + sc24.monthlyPassiveNet));
    setText('totalMensal24Bru', brl.format(b.monthlyCurrent + sc24.monthlyPassiveGross));

    // Payback e quanto faria no atual nesse tempo
    setText('payback12', sc12.paybackMonths);
    setText('payback24', sc24.paybackMonths);
    setText('fvPayback12', brl.format(sc12.fvPaybackNetBeforeIR));
    setText('fvPayback24', brl.format(sc24.fvPaybackNetBeforeIR));

    // Rodapé numérico
    setText('weeksPerMonth', params.weeksPerMonth);
    setText('vSemAtual', brl.format(b.weeklyCurrent));
    setText('vSemAtual2', brl.format(b.weeklyCurrent));
    setText('vSemanas', params.weeksPerMonth);
    setText('vMenAtual', brl.format(b.monthlyCurrent));
    setText('vSemOferta', brl.format(b.weeklyOffer));
    setText('vSemOferta2', brl.format(b.weeklyOffer));
    setText('vSemanas2', params.weeksPerMonth);
    setText('vMenOferta', brl.format(b.monthlyOffer));
    setText('vMenAtual2', brl.format(b.monthlyCurrent));
    setText('vMenOferta2', brl.format(b.monthlyOffer));
    setText('vDelta', brl.format(b.monthlyDelta));
    setText('vDeslAtual', (b.weeklyCurrentCommuteHours).toFixed(2));
    setText('vDeslOferta', (b.weeklyOfferCommuteHours).toFixed(2));
    setText('vSemAtual3', brl.format(b.weeklyCurrent));
    setText('vHorasAtuais', (params.current.h18 + params.current.h30 + b.weeklyCurrentCommuteHours).toFixed(2));
    setText('vHoraAtual', brl.format(b.effectiveHourlyCurrent));
    setText('vSemOferta3', brl.format(b.weeklyOffer));
    setText('vHorasOferta', (params.offer.hoursPerWeek + b.weeklyOfferCommuteHours).toFixed(2));
    setText('vHoraOferta', brl.format(b.effectiveHourlyOffer));

    setText('vRmBru', pct(b.rMonthGross));
    setText('vRmLiq', pct(b.rMonthNetBeforeIR));

    setText('vDelta12', brl.format(b.monthlyDelta));
    setText('vPerda12', brl.format(sc12.cumulativeLoss));
    setText('vMenAtual3', brl.format(b.monthlyCurrent));
    setText('vGanho12', brl.format(sc12.monthlyGainPostPromo));
    setText('vPerda12b', brl.format(sc12.cumulativeLoss));
    setText('vGanho12b', brl.format(sc12.monthlyGainPostPromo));
    setText('vPay12', sc12.paybackMonths);
    setText('vFVLiq12', brl.format(sc12.fvNetBeforeIR));
    setText('vRendaBru12', brl.format(sc12.monthlyPassiveGross));
    setText('vRendaLiq12', brl.format(sc12.monthlyPassiveNet));

    setText('vDelta24', brl.format(b.monthlyDelta));
    setText('vPerda24', brl.format(sc24.cumulativeLoss));
    setText('vMenAtual4', brl.format(b.monthlyCurrent));
    setText('vGanho24', brl.format(sc24.monthlyGainPostPromo));
    setText('vPerda24b', brl.format(sc24.cumulativeLoss));
    setText('vGanho24b', brl.format(sc24.monthlyGainPostPromo));
    setText('vPay24', sc24.paybackMonths);
    setText('vFVLiq24', brl.format(sc24.fvNetBeforeIR));
    setText('vRendaBru24', brl.format(sc24.monthlyPassiveGross));
    setText('vRendaLiq24', brl.format(sc24.monthlyPassiveNet));

    // ===== Charts =====
    const common = { plugins: { legend: { display: false }, tooltip: { enabled: true } }, responsive: true, maintainAspectRatio: false, scales: { y: { ticks: { color: '#c9d1d9' }, grid: { color: '#1e2430' } }, x: { ticks: { color: '#c9d1d9' }, grid: { color: '#1a1f2b' } } } };

    new Chart(document.getElementById('chartHourly'), {
      type: 'bar',
      data: { labels: ['Atual', 'Oferta'], datasets: [{ data: [b.effectiveHourlyCurrent, b.effectiveHourlyOffer], backgroundColor: ['#4f46e5', '#06b6d4'] }] },
      options: { ...common, scales: { ...common.scales, y: { ...common.scales.y, beginAtZero: true } } }
    });

    new Chart(document.getElementById('chartMonthly'), {
      type: 'bar',
      data: { labels: ['Atual', 'Oferta pré-promo', 'Oferta pós-promo'], datasets: [{ data: [b.monthlyCurrent, b.monthlyOffer, 6000], backgroundColor: ['#06b6d4', '#06b6d4', '#16a34a'] }] },
      options: { ...common, scales: { ...common.scales, y: { ...common.scales.y, beginAtZero: true } } }
    });

    new Chart(document.getElementById('chartTimeCurrent'), {
      type: 'doughnut',
      data: { labels: ['Trabalho', 'Deslocamento'], datasets: [{ data: [params.current.h18 + params.current.h30, b.weeklyCurrentCommuteHours], backgroundColor: ['#4f46e5', '#16a34a'] }] },
      options: { plugins: { legend: { display: true, labels: { color: '#c9d1d9' } } }, cutout: '55%', responsive: true, maintainAspectRatio: false }
    });

    new Chart(document.getElementById('chartTimeOffer'), {
      type: 'doughnut',
      data: { labels: ['Trabalho', 'Deslocamento'], datasets: [{ data: [params.offer.hoursPerWeek, b.weeklyOfferCommuteHours], backgroundColor: ['#4f46e5', '#ef4444'] }] },
      options: { plugins: { legend: { display: true, labels: { color: '#c9d1d9' } } }, cutout: '55%', responsive: true, maintainAspectRatio: false }
    });

    new Chart(document.getElementById('chartLoss'), {
      type: 'bar',
      data: { labels: ['Perda 12m', 'Perda 24m'], datasets: [{ data: [sc12.cumulativeLoss, sc24.cumulativeLoss], backgroundColor: ['#ef4444', '#ef4444'] }] },
      options: { ...common, scales: { ...common.scales, y: { ...common.scales.y, beginAtZero: true } } }
    });

    new Chart(document.getElementById('chartPayback'), {
      type: 'bar',
      data: { labels: ['Meses para recuperar 12m', 'Meses para recuperar 24m'], datasets: [{ data: [sc12.paybackMonths, sc24.paybackMonths], backgroundColor: ['#f59e0b', '#f59e0b'] }] },
      options: { ...common, scales: { ...common.scales, y: { ...common.scales.y, beginAtZero: true, ticks: { precision: 0 } } } }
    });

    const invest12Ctx = document.getElementById('chartInvest12');
    new Chart(invest12Ctx, {
      type: 'line',
      data: { labels: sc12.series.map(p => p.mes), datasets: [{ data: sc12.series.map(p => p.saldo), borderColor: '#4f46e5', backgroundColor: 'rgba(79,70,229,0.25)', fill: true, tension: 0.25 }] },
      options: { ...common }
    });

    const invest24Ctx = document.getElementById('chartInvest24');
    new Chart(invest24Ctx, {
      type: 'line',
      data: { labels: sc24.series.map(p => p.mes), datasets: [{ data: sc24.series.map(p => p.saldo), borderColor: '#06b6d4', backgroundColor: 'rgba(6,182,212,0.25)', fill: true, tension: 0.25 }] },
      options: { ...common }
    });

    // Tabs
    const tab12Btn = document.getElementById('tab12Btn');
    const tab24Btn = document.getElementById('tab24Btn');
    const tab12 = document.getElementById('tab12');
    const tab24 = document.getElementById('tab24');
    tab12Btn.addEventListener('click', () => { tab12Btn.classList.add('active'); tab24Btn.classList.remove('active'); tab12.style.display = ''; tab24.style.display = 'none'; });
    tab24Btn.addEventListener('click', () => { tab24Btn.classList.add('active'); tab12Btn.classList.remove('active'); tab24.style.display = ''; tab12.style.display = 'none'; });
  }

  window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
